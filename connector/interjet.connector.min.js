var Interjet=Interjet||{};Interjet.Connector=function(options){var options=options||{};this.version="1.0.0";this.connector=false;this.connectorLoaded=false;this.queue=[];this.options={provider:"http://api.example.com/user/auth",id:"InterjetConnector",origin:null,autoLoad:true,onMessage:function(e){}};for(var i in options){this.options[i]=options[i]}this.handleResponse=function(event){if(this.options.origin===event.origin||!this.options.provider){this.options.onMessage.call(this,event)}};this.getHostOrigin=function(){var parser=document.createElement("a");parser.href=this.options.provider;this.options.origin=[parser.protocol,parser.host].join("//")};this.load=function(){var ifrm=document.createElement("iframe");ifrm.setAttribute("src",this.options.provider);ifrm.setAttribute("id",this.options.id);ifrm.style.width="0px";ifrm.style.height="0px";ifrm.style.border="0px";document.body.appendChild(ifrm);ifrm.addEventListener("load",function(){this.connectorLoaded=true;this.send()}.bind(this));this.connector=ifrm.contentWindow};this.addQueueMessage=function(message){this.queue.push(message)};this.addQueueMessages=function(messages){this.queue.concat(messages)};this.send=function(message,connector){if(!this.connectorLoaded){this.queue.push(message);return}var __connector=connector||this.connector;if(!message){this.queue.forEach(function(entry,index){__connector.postMessage(entry,"*");this.queue.splice(index,1)}.bind(this))}else{__connector.postMessage(message,"*")}};this.ready=function(fn){if(document.attachEvent?document.readyState==="complete":document.readyState!=="loading"){fn()}else{document.attachEvent?document.attachEvent("onDOMContentLoaded",fn):document.addEventListener("DOMContentLoaded",fn,false)}};if(this.options.autoLoad&&!!this.options.provider){this.ready(this.load.bind(this))}else{this.connectorLoaded=true}if(window.addEventListener){window.addEventListener("message",this.handleResponse.bind(this),false)}else{window.attachEvent("onmessage",this.handleResponse.bind(this))}if(!!this.options.provider){this.getHostOrigin()}};